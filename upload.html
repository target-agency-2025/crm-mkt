<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Upload de Imagens para Supabase</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
      background-color: #f5f5f5;
    }
    
    .container {
      background-color: white;
      padding: 30px;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    
    h1 {
      color: #333;
      text-align: center;
    }
    
    .upload-section {
      margin-bottom: 30px;
      padding: 20px;
      border: 2px dashed #ccc;
      border-radius: 5px;
      text-align: center;
    }
    
    input[type="file"] {
      margin: 15px 0;
      padding: 10px;
    }
    
    button {
      background-color: #4CAF50;
      color: white;
      padding: 12px 24px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 16px;
    }
    
    button:hover {
      background-color: #45a049;
    }
    
    button:disabled {
      background-color: #cccccc;
      cursor: not-allowed;
    }
    
    .status {
      margin: 15px 0;
      padding: 10px;
      border-radius: 4px;
    }
    
    .status.success {
      background-color: #dff0d8;
      color: #3c763d;
    }
    
    .status.error {
      background-color: #f2dede;
      color: #a94442;
    }
    
    .gallery {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 20px;
      margin-top: 30px;
    }
    
    .image-card {
      border: 1px solid #ddd;
      border-radius: 5px;
      overflow: hidden;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    
    .image-card img {
      width: 100%;
      height: 150px;
      object-fit: cover;
    }
    
    .image-card .image-info {
      padding: 10px;
      font-size: 12px;
    }
    
    .image-link {
      word-break: break-all;
      color: #1a0dab;
      text-decoration: none;
    }
    
    .image-link:hover {
      text-decoration: underline;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Upload de Imagens para Supabase</h1>
    
    <div class="upload-section">
      <h2>Enviar Nova Imagem</h2>
      <input type="file" id="fileInput" accept="image/*" />
      <button id="uploadButton">Enviar Imagem</button>
      <div id="status"></div>
    </div>
    
    <h2>Galeria de Imagens</h2>
    <div id="gallery" class="gallery">
      <p>Carregando imagens...</p>
    </div>
  </div>

  <script type="module">
    // Import Supabase client
    import { createClient } from 'https://esm.sh/@supabase/supabase-js@2'

    // Supabase credentials
    const SUPABASE_URL = "https://aeateysowyaaqdymlcra.supabase.co"
    const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFlYXRleXNvd3lhYXFkeW1sY3JhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTg4MzQwMzcsImV4cCI6MjA3NDQxMDAzN30.IM8Vd6ohZXUe9TfYJn2DZnASwlO-6xWu0Rbfv3VrxDM"

    // Create Supabase client
    const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY)

    // DOM elements
    const fileInput = document.getElementById('fileInput')
    const uploadButton = document.getElementById('uploadButton')
    const statusDiv = document.getElementById('status')
    const galleryDiv = document.getElementById('gallery')

    // Upload image function
    async function uploadImage() {
      const file = fileInput.files[0]
      
      if (!file) {
        showStatus('Por favor, selecione uma imagem.', 'error')
        return
      }

      // Disable button during upload
      uploadButton.disabled = true
      showStatus('Enviando imagem...', 'info')

      try {
        // Create file path
        const filePath = `uploads/${file.name}`
        
        // Upload file to Supabase Storage
        const { data, error } = await supabase
          .storage
          .from('imagens')
          .upload(filePath, file, {
            cacheControl: '3600',
            upsert: false
          })

        if (error) {
          throw error
        }

        // Get public URL
        const { data: { publicUrl } } = supabase
          .storage
          .from('imagens')
          .getPublicUrl(filePath)

        // Show success message with link
        showStatus(`Imagem enviada com sucesso! <a href="${publicUrl}" target="_blank" class="image-link">Ver imagem</a>`, 'success')
        
        // Refresh gallery
        listImages()
        
        // Clear file input
        fileInput.value = ''
      } catch (error) {
        console.error('Error uploading image:', error)
        showStatus(`Erro ao enviar imagem: ${error.message}`, 'error')
      } finally {
        uploadButton.disabled = false
      }
    }

    // List images function
    async function listImages() {
      try {
        // List files in the 'uploads' folder
        const { data, error } = await supabase
          .storage
          .from('imagens')
          .list('uploads', {
            limit: 100,
            offset: 0,
            sortBy: { column: 'name', order: 'asc' }
          })

        if (error) {
          throw error
        }

        if (data.length === 0) {
          galleryDiv.innerHTML = '<p>Nenhuma imagem encontrada.</p>'
          return
        }

        // Generate gallery HTML
        let galleryHTML = ''
        
        // Process each image
        for (const file of data) {
          // Get public URL for each image
          const { data: { publicUrl } } = supabase
            .storage
            .from('imagens')
            .getPublicUrl(`uploads/${file.name}`)
          
          galleryHTML += `
            <div class="image-card">
              <img src="${publicUrl}" alt="${file.name}" onError="this.src='https://via.placeholder.com/200x150?text=Imagem+Indispon%C3%ADvel';">
              <div class="image-info">
                <div><strong>${file.name}</strong></div>
                <div>Tamanho: ${(file.metadata.size / 1024).toFixed(2)} KB</div>
                <div>Enviado: ${new Date(file.created_at).toLocaleDateString('pt-BR')}</div>
                <a href="${publicUrl}" target="_blank" class="image-link">Ver imagem</a>
              </div>
            </div>
          `
        }
        
        galleryDiv.innerHTML = galleryHTML
      } catch (error) {
        console.error('Error listing images:', error)
        galleryDiv.innerHTML = `<p>Erro ao carregar imagens: ${error.message}</p>`
      }
    }

    // Show status message
    function showStatus(message, type) {
      statusDiv.innerHTML = message
      statusDiv.className = `status ${type}`
    }

    // Event listeners
    uploadButton.addEventListener('click', uploadImage)

    // Load images on page load
    listImages()
  </script>
</body>
</html>